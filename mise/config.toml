# =============================================================================
# Mise Configuration - Tool Version Management
# =============================================================================
# Docs: https://mise.jdx.dev/
# Symlink: ln -sf ~/.dotfiles/mise/config.toml ~/.config/mise/config.toml
# =============================================================================

[settings]
experimental = true
legacy_version_file = true
always_keep_install = true

[tools]
java = "21"
# ruby = "latest"  # Optional - install with: mise install ruby@latest

[env]
# =============================================================================
# JAVA CONFIGURATION (Required for Appium)
# =============================================================================
# Set JAVA_HOME to mise-managed Java installation
JAVA_HOME = "{{env.HOME}}/.local/share/mise/installs/java/21.0.2"

# =============================================================================
# ANDROID SDK CONFIGURATION (Required for Appium)
# =============================================================================
# Core Android environment variable - most tools derive paths from this
ANDROID_HOME = "{{env.HOME}}/Library/Android/sdk"

# Derived paths - some tools expect these as environment variables
ANDROID_PLATFORM_TOOLS = "{{env.ANDROID_HOME}}/platform-tools"
ANDROID_EMULATOR = "{{env.ANDROID_HOME}}/emulator"
ANDROID_TOOLS = "{{env.ANDROID_HOME}}/tools"
ANDROID_TOOLS_BIN = "{{env.ANDROID_HOME}}/tools/bin"
ANDROID_CMDLINE_TOOLS = "{{env.ANDROID_HOME}}/cmdline-tools/latest/bin"

# Optional: bundletool for building APKs from AABs
BUNDLETOOL_PATH = "{{env.ANDROID_HOME}}/tools/bundletool.jar"

# =============================================================================
# TASKS
# =============================================================================

[tasks.check]
description = "Validate setup"
run = '''
echo "=== Tool Versions ==="
echo "Java:   $(java -version 2>&1 | head -1)"
echo "Mise:   $(mise --version)"
echo ""
echo "=== Environment ==="
echo "JAVA_HOME:    $JAVA_HOME"
echo "ANDROID_HOME: $ANDROID_HOME"
'''

[tasks.check-env]
description = "Check critical environment variables"
run = '''
echo "=== Environment Variables ==="
echo "JAVA_HOME:     ${JAVA_HOME:-NOT SET}"
echo "ANDROID_HOME:  ${ANDROID_HOME:-NOT SET}"
if [[ -n "$JAVA_HOME" ]]; then echo "✓ JAVA_HOME is set"; else echo "✗ JAVA_HOME missing"; fi
if [[ -n "$ANDROID_HOME" && -d "$ANDROID_HOME" ]]; then echo "✓ ANDROID_HOME exists"; else echo "✗ ANDROID_HOME missing"; fi
'''

[tasks.mobile-check]
description = "Full mobile development check"
run = '''
echo "=== Mobile Development Environment ==="
echo ""
echo "JAVA_HOME: $JAVA_HOME"
java -version 2>&1 | head -1
echo ""
echo "ANDROID_HOME: $ANDROID_HOME"
which adb 2>/dev/null && adb --version | head -1 || echo "adb not found"
echo ""
echo "Appium:"
appium --version 2>/dev/null || echo "appium not installed"
'''

[tasks.appium-doctor]
description = "Run Appium driver doctors"
run = '''
echo "=== UIAutomator2 Doctor ==="
appium driver doctor uiautomator2 || true
echo ""
echo "=== XCUITest Doctor ==="
appium driver doctor xcuitest || true
'''
